# avito-task

Требуется реализовать сервис, хранящий пользователя и сегменты, в которых он состоит
(создание, изменение, удаление сегментов, а также добавление и удаление
пользователей в сегменты)

# Запуск

В файле ./configs/config.yaml установить нужные значения или оставить их по умолчанию.

```bash
make doker-build
make docker-run
```

# Формат запросов 

Запросы выполнял с помощью Postman

## Создание сегментов 

Условие задания не запрещало запросы, в которых добавляемый сегмент повторяется несколько раз.
Я решил, что на этот сегмент будет выводится только один ответ, который был первым.

* если сегмент был создан, то вернется сообщение `created`.

* если сегмент уже был добавлен ранее, то вернется сообщение `already exist`.

* если при создании сегмента возникнет ошибка, то вернется сообщение `not created`.

### Пример запроса:

`POST localhost:3000/api/segments`

```json
{
  "segments":[
      "AVITO_VOICE_MESSAGES",
      "AVITO_PERFORMANCE_VAS",
      "AVITO_DISCOUNT_30",
      "AVITO_VOICE_MESSAGES"
    ]
}
```

### Пример ответа от сервера:

```json
{
  "AVITO_DISCOUNT_30": "created",
  "AVITO_PERFORMANCE_VAS": "created",
  "AVITO_VOICE_MESSAGES": "created"
}
```

### Пример запроса:

`POST localhost:3000/api/segments`

```json
{ 
    "segments":[
      "AVITO_VOICE_MESSAGES",
      "AVITO_DISCOUNT_30",
      "AVITO_DISCOUNT_30",
      "AVITO_DISCOUNT_50"
    ]
}
```

### Ответ от сервера:
```json
{ 
    "AVITO_DISCOUNT_30": "already exist",
    "AVITO_DISCOUNT_50": "created",
    "AVITO_VOICE_MESSAGES": "already exist"
}
```

## Создание пользователей

Схема ответа такая же, как при создании сегмента. 

* если пользователь будет создан, то вернется `created`.
* если пользователь уже был создан ранее, то вернется `already exist`
* если при создании пользователя возникнет ошибка, то вернется `not created`

### Пример запроса:

`POST localhost:3000/api/users`

```json
{
    "users":[
        32,
        64, 
        128, 
        128
    ]
}
```

### Ответ от сервера:

```json
{
    "128": "created",
    "32": "created",
    "64": "created"
}
```

### Пример запроса:

`POST localhost:3000/api/users`

```json
{
    "users":[
      32,
      128,
      256
    ]
}
```

### Ответ от сервера:

```json
{
    "128": "already exist",
    "256": "created",
    "32": "already exist"
}
```
    
## Обновление сегментов пользователя 

Если такого пользователя не существует, то в json в поле id вернется -1,
а поля add и delete будут пустыми.

Если пользователь существует, то на каждый сегмент в поле add 
будут выведены следующие сообщения:
* `not created` если такого сегмента не было создано
* `added` если пользователь был добавлен в сегмент
* `already exist` если пользователь был добавлен в сегмент ранее
* `error` если при добавлении пользователя в сегмент возникла ошибка

На каждый сегмент в поле delete будет выведены слудующие сообщения:
* `not created` если такого сегмента не было создано
* `removed` если пользователь был удален из сегмента
* `not exist` если пользователь не содержится в сегменте
* `error` если при удалении пользователя из сегмента возникла ошибка

### Пример запроса:

`POST localhost:3000/api/update`

```json
{
    "id": 32,
    "add":[
        "AVITO_VOICE_MESSAGES",
        "AVITO_PERFORMANCE_VAS"
    ],
    "delete":[
        "NO_SEGMENT"
    ]
}
```

### Ответ от сервера:

```json
{
    "id": 32,
    "add": {
        "AVITO_PERFORMANCE_VAS": "added",
        "AVITO_VOICE_MESSAGES": "added"
    },
    "delete": {
        "NO_SEGMENT": "not created"
    }
}
```

### Пример запроса:

```json
{
    "id": 10000,
    "add":[
        "AVITO_VOICE_MESSAGES",
        "AVITO_PERFORMANCE_VAS"
    ],
    "delete":[
        "NO_SEGMENT"
    ]
}
```

### Ответ от сервера: 

```json
{
    "id": -1,
    "add": {},
    "delete": {}
}
```

### Пример запроса:

```json
{
    "id": 32,
    "add":[
        "AVITO_VOICE_MESSAGES",
        "AVITO_DISCOUNT_30"
    ],
    "delete":[
        "AVITO_PERFORMANCE_VAS",
        "AVITO_DISCOUNT_50"
    ]
}
```

### Ответ от сервера:

```json
{
    "id": 32,
    "add": {
        "AVITO_DISCOUNT_30": "added",
        "AVITO_VOICE_MESSAGES": "already exist"
    },
    "delete": {
        "AVITO_DISCOUNT_50": "not exist",
        "AVITO_PERFORMANCE_VAS": "removed"
    }
}
```

## Получение сегментов пользователя

ID пользователя передается через параметры get запроса.

* если переданный id не число, то вернется код ответа `400`
* если такой пользователь существует, то вернется список его сегментов
* если такого пользователя не существует, то в поле id вернется -1, в поле segments
вернется null, а также код ответа будет `404`

### Пример запроса: 

`GET localhost:3000/api/segments?user_id=32`

### Ответ от сервера:
```json
{
    "id": 32,
    "segments": [
        "AVITO_VOICE_MESSAGES",
        "AVITO_DISCOUNT_30"
    ]
}
```

### Пример некорректного запроса: 

`GET localhost:3000/api/segments?user_id=number`

Такой запрос вернет код ответа `400 - Bad Request`

### Пример для пользователя не входящего ни в один сегмент:

`GET localhost:3000/api/segments?user_id=64`

### Ответ от сервера:

```json
{
    "id": 64,
    "segments": null
}
```

### Пример для несозданного пользователя: 

`GET localhost:3000/api/segments?user_id=100000`

### Ответ от сервера:

```json
{
    "id": -1,
    "segments": null
}
```

Также вернется код ответа `404`

## Удаление сегмента

* если сегмент существует, то после удаления будет возвращен код ответа `200`.

* если сегмент отстутствует, то вернется код ответа `404`.

### Пример удаления существующего сегмента:

`DELETE localhost:3000/api/segments?name=AVITO_VOICE_MESSAGES`

Такой запрос вернет код ответа `200`. 

### Пример удаления несозданного сегмента:

`DELETE localhost:3000/api/segments?name=AVITO_VOICE_MESSAGES`

Т.к. на предыдущем шаге сегмент был удален, то вернется код ответа `404`.

## Удаление пользователя 

* если пользователь существует, то после удаления будет возвращен код ответа `200`.

* если пользователь отстутствует, то вернется код ответа `404`.

* если в параметрах запроса передали не число, то вернется код ответа `400`.

### Пример успешного удаления:

`DELETE localhost:3000/api/users?id=128`

Такой запрос вернет код ответа `200`.

### Пример удаления несозданного пользователя:

`DELETE localhost:3000/api/users?id=128`

Т.к. на предыдущем шаге пользователь был удален, то  вернется код ответа `404`.

### Пример неправильного запроса:

`DELETE localhost:3000/api/users?id=lol`

Такой запрос вернет код ответа `400`.